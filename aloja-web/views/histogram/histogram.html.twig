{% extends "layout.html.twig" %}

{% block stylesheet %}
    {{ parent() }}
{% endblock %}

{% block javascript %}
    {{ parent() }}
    {{ highcharts_js|raw }}

    <script>
        $(document).ready(function() {

            $('select').change(function() {
                $(this).parents('form').submit();
            });

            $('#chart').highcharts({
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Histogram'
                },
                subtitle: {
                    text: '{{ jobid }}'
                },
                xAxis: {
                    type: 'category',
                    labels: {
                        rotation: -45,
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: '{{ metric }}'
                    }
                },
                tooltip: {
                    shared: true,
                    useHTML: true
                },
                plotOptions: {
                    column: {
                        groupPadding: 0,
                        pointPadding: 0,
                        borderWidth: 0,
                    }
                },
                series: 
                    [
                        {
                            name: "{{ metric }}",
                            showInLegend: false,
                            data: [
                                {{ seriesData | raw }}
                            ],
                        },
                        {% if seriesError is not empty %}
                            {
                                name: "Error",
                                type: 'errorbar',
                                showInLegend: false,
                                color: '#DF5353',
                                stemWidth: 3,
                                whiskerLength: 0,
                                tooltip: {
                                    pointFormat: '<span style="color:{series.color}">\u25CF</span> {series.name}: <b>&plusmn;{point.stddev}</b><br/>',
                                },
                                data: [
                                    {{ seriesError | raw }}
                                ],
                            },
                        {% endif %}
                    ]
            });
        });
    </script>
{% endblock %}

{% block navigation %}
    {{ parent() }}

    <div id="navigation" style="text-align: center;">
        <h1>Histogram</h1>
        <div id="filters" style="text-align: left;">
            <form method="GET">
                <input type="hidden" name="jobid" value="{{ jobid }}">
                <strong>Metric: </strong>
                <select name="metric">
                    {% for current_metric in METRICS %}
                        <option value="{{ loop.index0 }}" {% if current_metric == metric %}selected="selected"{% endif %}>{{ current_metric }}</option>
                    {% endfor %}
                </select>
                &nbsp;&nbsp;&nbsp;
                <strong>Group every: </strong>
                <input type="text" name="group" value="{{ group }}" size="4">
                &nbsp;&nbsp;&nbsp;
                <strong>Accumulated: </strong>
                <select name="accumulated">
                    <option value="0" {% if accumulated == 0 %}selected="selected"{% endif %}>Disabled</option>
                    <option value="1" {% if accumulated == 1 %}selected="selected"{% endif %}>Metric</option>
                    <option value="2" {% if accumulated == 2 %}selected="selected"{% endif %}>Metric/Task Duration</option>
                    <option value="3" {% if accumulated == 3 %}selected="selected"{% endif %}>Metric/Accumulated Duration</option>
                </select>
            </form>
        </div>
        <div id="chart" style="margin: 0 auto"></div>
    </div>

{% endblock %}
